# フリッカー／霧化 検知公式・実装メモ（1ページ版）

**⚠️ 本ページは検知・診断専用。生成ルールとして使うと品質が下がる。**

## 0. 用語（最短）

- **フリッカー**：動きすぎて意味が点滅する状態
- **霧化**：名詞塊が重なって意味が霞む状態

---

## 1. コア数式（2本＋統合スコア）

### 1.1 霧化（Fog）指標

```
F_fog = α·(N/D) + β·Dep + γ·NomChain
```

**パラメータ：**
- **N**：名詞数
- **D**：動詞数（0回避で `D = max(D,1)`）
- **Dep**：係り受け平均深さ
- **NomChain**：連続名詞長の平均
- **α, β, γ**：重み（例：0.5, 0.3, 0.2）

**参考閾値：** `F_fog > 1.8` で警告

### 1.2 フリッカー（Flicker）指標

```
F_flick = λ·(D/N) + μ·VerbBurst + ν·RoleDrop
```

**パラメータ：**
- **VerbBurst**：動詞の連続度（文内最大連続数/文長）
- **RoleDrop**：`∃i∈{S,O,V,T,C} s.t. R_i=0` を満たす比率
  - S=主語, O=目的語, V=述語, T=時制/時間, C=条件（責任ループ）

| 欠落役割 | 傾向 | 例 |
|---------|------|-----|
| **S欠落** | フリッカー↑ | 「実装することを検討する」（誰が？） |
| **O欠落** | フリッカー↑ | 「効率を上げて実装する」（何を？） |
| **V欠落** | 霧化↑ | 「効率性の向上の実装」（動詞なし） |
| **T欠落** | 軽度フリッカー | 「実装を検討」（いつ？） |
| **C欠落** | 軽度フリッカー | 「実装する」（条件は？） |

- **λ, μ, ν**：重み（例：0.5, 0.3, 0.2）

**参考閾値：** `F_flick > 1.2` で警告

### 1.3 統合品質スコア（中央値モデル）

**正規化式：**
```
F̂_fog = min(F_fog / 3.6, 0.5)
F̂_flick = min(F_flick / 2.4, 0.5)
```

**統合スコア：**
```
Q = 1 - (F̂_fog + F̂_flick)
```

- **正規化根拠**：警告閾値の2倍で0.5に到達（F_fog: 1.8×2=3.6, F_flick: 1.2×2=2.4）
- **目安**：`Q < 0.4` で要修正、`Q < 0.2` でNG

---

## 2. 補助モデル（既出理論の対応）

- **意味の位置エネルギー**：`E_s = Z·R·V` → R（責任配置）が下がるとフリッカー化
- **意味の慣性**：`I_s = Σ_i P_i D_i²` → 名詞塊の慣性が大きいと霧化
- **責任ループ**：`∃i∈{S,O,V,T,C}: R_i=0` → 役割欠落でフリッカー上昇
- **位相流**：`F_進行 = F_推進 + F_責任重力 - F_構文抵抗` → 抵抗過大は霧化、推進過大はフリッカー
- **意味エントロピー**：`S_sem = -Σ p_i log p_i` → 高すぎで霧化、低すぎで硬直

---

## 3. 実装手順（最短アルゴリズム）

**入力**：文  
**前処理**：形態素・係り受け解析

1. **計数**：N, D, 係り受け深さ Dep、連続名詞長 NomChain、動詞連続度 VerbBurst
2. **役割判定**：S/O/V/T/C の有無 → RoleDrop を更新
3. **スコア**：`F_fog`, `F_flick`, `Q` を計算
4. **判定**：
   - `F_fog > 1.8` → 霧化警告
   - `F_flick > 1.2` → フリッカー警告
   - `Q < 0.4` → 要修正、`Q < 0.2` → NG
5. **ログ**：どの項目が効いたかを出す（例：「NomChain↑, RoleDrop(S)」）

---

## 4. 例（1文ずつ）

### 霧化例
**「効率性の向上の実装の検討の必要性」**
- N/D 高、NomChain 高、Dep 深 → `F_fog` 高

### フリッカー例  
**「効率を上げることを実装することを検討する」**
- D/N 高、VerbBurst 高、RoleDrop(O) → `F_flick` 高

---

## 5. 運用ルール（重要）

- **検知→校正**で使う。**生成器に直結しない**
- 閾値は**ドメイン別に再調整**する
- バッチ適用は**段階導入＋ロールバック**前提

---

## 6. パラメータの初期値（参考）

- **霧化**：α=0.5, β=0.3, γ=0.2
- **フリッカー**：λ=0.5, μ=0.3, ν=0.2  
- **正規化範囲**：F̂ ∈ [0, 0.5]

### パラメータ調整推奨手順
1. **α, λ を 0.5 に固定**（名詞・動詞比の影響を基準化）
2. **β, γ, μ, ν を ±0.05 刻みで調整**し、Q が最大になる組み合わせを採用

---

**ライセンス**：MIT  
**作者**：Viorazu.  
**備考**：本ページの数式は**概念モデル**。実運用ではコーパスで再学習して重みを最適化すること。
